<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-02-13">

<title>BI for Beginners Session 4 – KIND training pages</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-8647a4a42273f773479d27c00df3f9ed.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-4c1b98738ec0874d9dae211e7ab2f05d.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../site_libs/quarto-contrib/iconify-2.1.0/iconify-icon.min.js"></script>
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">KIND training pages</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../excel_main.html"> 
<span class="menu-text">Excel</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../r_main.html"> 
<span class="menu-text">R</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../BI_main.html"> 
<span class="menu-text">Power BI</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../tableau_main.html"> 
<span class="menu-text">Tableau</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../skills_main.html"> 
<span class="menu-text">Skills</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html"> 
<span class="menu-text">📅 Training schedule</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/NES-DEW/KIND-training">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/NES-DEW/KIND-training/issues">
            Report a Bug
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#previous-attendees-have-said" id="toc-previous-attendees-have-said" class="nav-link active" data-scroll-target="#previous-attendees-have-said">Previous attendees have said…</a></li>
  <li><a href="#session-outline" id="toc-session-outline" class="nav-link" data-scroll-target="#session-outline">Session outline</a></li>
  <li><a href="#session-files" id="toc-session-files" class="nav-link" data-scroll-target="#session-files">Session files</a></li>
  <li><a href="#recap" id="toc-recap" class="nav-link" data-scroll-target="#recap">Recap</a></li>
  <li><a href="#major-differences-between-dax-and-excel-formulas" id="toc-major-differences-between-dax-and-excel-formulas" class="nav-link" data-scroll-target="#major-differences-between-dax-and-excel-formulas">Major differences between DAX and Excel formulas</a></li>
  <li><a href="#set-up" id="toc-set-up" class="nav-link" data-scroll-target="#set-up">Set up</a></li>
  <li><a href="#the-model" id="toc-the-model" class="nav-link" data-scroll-target="#the-model">The model</a></li>
  <li><a href="#dax-first-steps" id="toc-dax-first-steps" class="nav-link" data-scroll-target="#dax-first-steps">DAX first steps</a></li>
  <li><a href="#dax-queries" id="toc-dax-queries" class="nav-link" data-scroll-target="#dax-queries">DAX queries</a></li>
  <li><a href="#wth-are-measures" id="toc-wth-are-measures" class="nav-link" data-scroll-target="#wth-are-measures">WTH are measures?</a></li>
  <li><a href="#dax-queries-1" id="toc-dax-queries-1" class="nav-link" data-scroll-target="#dax-queries-1">DAX queries</a></li>
  <li><a href="#adding-our-measure-to-our-report" id="toc-adding-our-measure-to-our-report" class="nav-link" data-scroll-target="#adding-our-measure-to-our-report">Adding our measure to our report</a></li>
  <li><a href="#adding-our-measure-to-our-report-1" id="toc-adding-our-measure-to-our-report-1" class="nav-link" data-scroll-target="#adding-our-measure-to-our-report-1">Adding our measure to our report</a></li>
  <li><a href="#making-a-measures-table" id="toc-making-a-measures-table" class="nav-link" data-scroll-target="#making-a-measures-table">Making a measures table</a></li>
  <li><a href="#concatenating" id="toc-concatenating" class="nav-link" data-scroll-target="#concatenating">Concatenating</a></li>
  <li><a href="#core-dax-functions" id="toc-core-dax-functions" class="nav-link" data-scroll-target="#core-dax-functions">Core DAX functions</a></li>
  <li><a href="#combining-functions" id="toc-combining-functions" class="nav-link" data-scroll-target="#combining-functions">Combining functions</a></li>
  <li><a href="#combining-functions-1" id="toc-combining-functions-1" class="nav-link" data-scroll-target="#combining-functions-1">Combining functions</a></li>
  <li><a href="#combining-functions-2" id="toc-combining-functions-2" class="nav-link" data-scroll-target="#combining-functions-2">Combining functions</a></li>
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter">Filter</a></li>
  <li><a href="#filter-1" id="toc-filter-1" class="nav-link" data-scroll-target="#filter-1">Filter</a></li>
  <li><a href="#filter-2" id="toc-filter-2" class="nav-link" data-scroll-target="#filter-2">Filter</a></li>
  <li><a href="#filter-3" id="toc-filter-3" class="nav-link" data-scroll-target="#filter-3">Filter</a></li>
  <li><a href="#beautifying-average_practice" id="toc-beautifying-average_practice" class="nav-link" data-scroll-target="#beautifying-average_practice">Beautifying <strong>average_practice</strong></a></li>
  <li><a href="#more-interesting-filters" id="toc-more-interesting-filters" class="nav-link" data-scroll-target="#more-interesting-filters">More interesting filters</a></li>
  <li><a href="#dax-resources-beginners" id="toc-dax-resources-beginners" class="nav-link" data-scroll-target="#dax-resources-beginners">DAX resources (beginners)</a></li>
  <li><a href="#dax-resources-advanced" id="toc-dax-resources-advanced" class="nav-link" data-scroll-target="#dax-resources-advanced">DAX resources (advanced)</a></li>
  </ul>
</nav>
    <div class="quarto-margin-footer"><div class="margin-footer-item">
<p xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/">
<a property="dct:title" rel="cc:attributionURL" href="https://nes-dew.github.io/KIND-training">KIND learning network training materials</a> by <span property="cc:attributionName">KIND learning network</span> is licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-SA 4.0<img style="height:16px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" alt=""><img style="height:16px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" alt=""><img style="height:16px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1" alt=""></a>
</p>
</div></div></div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">BI for Beginners Session 4</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Power BI</div>
    <div class="quarto-category">beginner</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 13, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Session materials
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Ideally, you’ll use the data that you wrangled during the previous session. But if that’s not suitable, use this data:</p>
<ul>
<li><a href="src/s04_data.xlsx"><iconify-icon inline="" icon="ph:file-xls" style="font-size: 2em;" aria-label="Icon file-xls from ph Iconify.design set." title="Icon file-xls from ph Iconify.design set."></iconify-icon>.xlsx session data</a></li>
</ul>
<p>There’s also a starting-point pbix file which you might prefer to use instead:</p>
<ul>
<li><a href="src/BfB_s03.pbix"><iconify-icon inline="" icon="arcticons:microsoft-power-bi" style="font-size: 2em;" aria-label="Icon microsoft-power-bi from arcticons Iconify.design set." title="Icon microsoft-power-bi from arcticons Iconify.design set."></iconify-icon>.pbix starting file</a></li>
</ul>
</div>
</div>
</div>
<section id="previous-attendees-have-said" class="level2 cell" data-layout-align="left">
<h2 class="anchored" data-anchor-id="previous-attendees-have-said">Previous attendees have said…</h2>
<ul>
<li>60 previous attendees have left feedback</li>
<li>100% would recommend this session to a colleague</li>
<li>97% said that this session was pitched correctly</li>
</ul>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="BI_for_beginners_session_04_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid quarto-figure quarto-figure-left figure-img" width="288"></p>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Three random comments from previous attendees
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Sessions are great - some info went over my head a bit, but Brendan is excellent at describing everything and also having alternative methods of working so everyone can follow.</li>
<li>I’m a beginner with some previous experience of being an end user getting data from powerBi so I have an understanding of the possibilities. I found the method of clicking along very helpful tied with Brendan’s positive presentation skills in openly checking issues and answering queries most beneficial. The level of content was right for me until the last session - I have no experience of DAX so this was all newer. I have been able to apply the skills I have learned with confidence. I feel I’m still lacking a better understanding of the semantics model and if I have a recurring set of data ie datix incidents, how I can update the data in a dashboard without having to rebuild the dashboard each time.</li>
<li>Really interesting about use of measures.</li>
</ul>
</div>
</div>
</section>
<section id="session-outline" class="level2">
<h2 class="anchored" data-anchor-id="session-outline">Session outline</h2>
<ul>
<li>In this session, we’re going to build out the GP practice size dashboard from last time</li>
<li>we’re going to use some new features of Power BI to help us with that
<ul>
<li>we’ll spend a little bit of time looking at the model</li>
<li>but most of the session is about DAX and measures</li>
</ul></li>
</ul>
</section>
<section id="session-files" class="level2">
<h2 class="anchored" data-anchor-id="session-files">Session files</h2>
<ul>
<li><code>BfB_s03.pbix</code> as starting point</li>
<li><code>BfB_s04.pbix</code> as completed example</li>
</ul>
</section>
<section id="recap" class="level2">
<h2 class="anchored" data-anchor-id="recap">Recap</h2>
<ul>
<li>we did lots of data wrangling last week using Power Query</li>
<li>that’s designed to do data loading and tidying - so we tried removing some data, reshaping data, and joining data,…</li>
<li>but there’s another whole language in Power BI to let us do things with that tidy data: DAX (annoyingly, <strong>Data Analysis eXpressions</strong>)</li>
<li>similar to Excel formulas</li>
</ul>
</section>
<section id="major-differences-between-dax-and-excel-formulas" class="level2">
<h2 class="anchored" data-anchor-id="major-differences-between-dax-and-excel-formulas">Major differences between DAX and Excel formulas</h2>
<ul>
<li>Excel takes a cell or range of cells (like A4)
<ul>
<li>DAX functions take a <strong>column or table</strong> as reference, and cannot use e.g.&nbsp;cell ranges</li>
</ul></li>
<li>Excel formulas show their results directly in the cell
<ul>
<li>DAX formulas need to be added to a card (or similar)</li>
</ul></li>
<li>also a grab-bag of minor differences (no mixed columns data type, date and time functions, different lookup mechanics)</li>
</ul>
</section>
<section id="set-up" class="level2">
<h2 class="anchored" data-anchor-id="set-up">Set up</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="Task">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>open your dashboard from the last session (or you can use <code>BfB_s03.pbix</code>)</li>
<li>add a new report page, and name it <strong>measures</strong></li>
<li>remind yourself about the data we’re working with</li>
</ol>
</div>
</div>
</section>
<section id="the-model" class="level2">
<h2 class="anchored" data-anchor-id="the-model">The model</h2>
<ul>
<li>let’s start by looking at the model view</li>
<li>we should see our data tables as blocks in the model</li>
<li>thre are also connections between some of those blocks</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled" title="Task">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Mouse-over the relationships in the model view</li>
<li>What’s the difference between <img src="images/star.png" class="img-fluid" alt="star"> and <img src="images/one.png" class="img-fluid" alt="one">?</li>
<li>Now expand the <strong>Properties</strong> pane</li>
</ol>
</div>
</div>
</section>
<section id="dax-first-steps" class="level2">
<h2 class="anchored" data-anchor-id="dax-first-steps">DAX first steps</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="Task">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>in either the report or the data views, click <strong>New measure</strong></li>
<li>in the formula bar, add <code>largest_practice = MAX(practices[PracticeListSize])</code></li>
</ol>
</div>
</div>
</section>
<section id="dax-queries" class="level2">
<h2 class="anchored" data-anchor-id="dax-queries">DAX queries</h2>
<p>The general way of building a DAX formula is as follows:</p>
<blockquote class="blockquote">
<p>measure = FUNCTION(table[column])</p>
</blockquote>
<ul>
<li>note the [square brackets] for column names</li>
<li>we wrote a simple DAX formula in the first session, when we calculated a column using the formula <code>AvailableBeds = [BedComp] - [ClosedBed]</code></li>
<li>in this session, we’re going to concentrate on using DAX to write <strong>measures</strong></li>
</ul>
</section>
<section id="wth-are-measures" class="level2">
<h2 class="anchored" data-anchor-id="wth-are-measures">WTH are measures?</h2>
<ul>
<li><strong>measures</strong> are Power BI lingo for calculated data summaries</li>
<li>calculated columns, as we’ve seen before, let you make new columns from existing data</li>
<li>measures allow you to make non-column summaries of your data - like an average</li>
</ul>
</section>
<section id="dax-queries-1" class="level2">
<h2 class="anchored" data-anchor-id="dax-queries-1">DAX queries</h2>
<p>For our example, our measure is called <strong>largest_practice</strong>, and we want it to report the largest practice in each health board. Our DAX-based measure works as follows:</p>
<ul>
<li>our data table is called <strong>practices</strong></li>
<li>our column is <strong>PracticeListSize</strong></li>
<li>we’re using the <code>MAX()</code> function to find the largest value (exactly like Excel)</li>
</ul>
<blockquote class="blockquote">
<p>largest_practice = MAX(practices[PracticeListSize])</p>
</blockquote>
</section>
<section id="adding-our-measure-to-our-report" class="level2">
<h2 class="anchored" data-anchor-id="adding-our-measure-to-our-report">Adding our measure to our report</h2>
<ul>
<li>we should be able to add our <strong>largest_practice</strong> measure to our report</li>
<li>go back to the report view, and refresh</li>
<li>you should see the <strong>largest_practice</strong> measure appear in the data pane <br><img src="images/measure.png" height="300" alt="largest_practice measure in data pane"></li>
</ul>
</section>
<section id="adding-our-measure-to-our-report-1" class="level2">
<h2 class="anchored" data-anchor-id="adding-our-measure-to-our-report-1">Adding our measure to our report</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="Task">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>in our new measures page, drag the <strong>largest_practice</strong> measure into a new card</li>
<li>we also want to be able to look at different boards, so add a slicer using the HBnames from the practices table</li>
<li>we’ll then play with the interactions to make sure that this measure gives us a sensible result <br><img src="images/editinteractions.png" height="200" alt="edit interactions"></li>
</ol>
</div>
</div>
</section>
<section id="making-a-measures-table" class="level2">
<h2 class="anchored" data-anchor-id="making-a-measures-table">Making a measures table</h2>
<ul>
<li>it’s helpful to keep your measures in a stand-alone measures table - but requires a bit of creativity</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled" title="Task">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>manually create an empty table using <strong>Enter data</strong> <br> <img src="images/measurest.png" height="150" alt="Enter data"></li>
<li>select your <strong>largest_practice</strong> measure, go to the data view, and use the <strong>Home table</strong> menu to move it to your new measures table</li>
<li>then delete the blank column from your measures table</li>
</ul>
</div>
</div>
</section>
<section id="concatenating" class="level2">
<h2 class="anchored" data-anchor-id="concatenating">Concatenating</h2>
<ul>
<li>so far, our <code>largest_practice</code> measure is ugly-but-functional</li>
<li>we can use the concatenate operator (<code>&amp;</code>) to beautify it</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled" title="Task">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>edit your <code>largest_practice</code> measure</li>
<li>you can insert text by “quoting” it, and using <code>&amp;</code> to join it to the result of your <code>MAX()</code>
<ul>
<li>for instance, <code>largest_practice = "Largest practice: " &amp; max(practices[PracticeListSize]) &amp; " patients"</code></li>
</ul></li>
<li>feel free to experiment - make sure you go back to the report view and refresh to see changes</li>
<li>you can also use the <strong>format visual</strong> section to change the font size, and drop/alter the category label</li>
</ol>
</div>
</div>
</section>
<section id="core-dax-functions" class="level2">
<h2 class="anchored" data-anchor-id="core-dax-functions">Core DAX functions</h2>
<ul>
<li>several useful DAX functions work in basically the same way as <code>MAX()</code></li>
<li>let’s try them out now</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled" title="Task">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>in your measures table, make a new measure called <code>average_practice</code></li>
<li>try <code>average_practice = AVERAGE(practices[PracticeListSize])</code></li>
<li>add this to a new card to test it</li>
<li>now tweak with concatenated text</li>
<li><code>COUNT()</code>, and <code>MIN()</code> should also work in the same way</li>
</ol>
</div>
</div>
</section>
<section id="combining-functions" class="level2">
<h2 class="anchored" data-anchor-id="combining-functions">Combining functions</h2>
<ul>
<li>most measures will need more than one DAX function</li>
<li>we combine functions just like Excel, by bracketing them together</li>
<li><code>function1(function2(data))</code> does function 2 on the data, then function 1 on that result</li>
<li>when you’re reading/building formulas with many functions, two top-tips:
<ol type="1">
<li>make sure you match your brackets</li>
<li>read from the inside out</li>
</ol></li>
</ul>
</section>
<section id="combining-functions-1" class="level2">
<h2 class="anchored" data-anchor-id="combining-functions-1">Combining functions</h2>
<ul>
<li>our <strong>average_practice</strong> measure is pretty ugly</li>
<li>a whole number value would be more suitable</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled" title="Task">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>click on the <strong>average_practice</strong> measure, which should read <code>average_practice = AVERAGE(practices[PracticeListSize])</code></li>
<li>add the <code>INT()</code> function, which converts a number to an integer (whole number)
<ul>
<li>we want <code>INT()</code> to wrap around the <code>AVERAGE()</code> function</li>
<li><code>average_practice = INT(AVERAGE(practices[PracticeListSize]))</code></li>
</ul></li>
</ul>
</div>
</div>
</section>
<section id="combining-functions-2" class="level2">
<h2 class="anchored" data-anchor-id="combining-functions-2">Combining functions</h2>
<ul>
<li>we can keep combining functions together in the same way</li>
<li>e.g.&nbsp;we could round that result to the nearest hundred using <code>round(..., -2)</code>
<ul>
<li>the <code>-2</code> specifies the number of decimal places, so <code>3</code> here would give us 3 decimal places (say 444.444).</li>
<li><code>average_practice = ROUND(INT(AVERAGE(practices[PracticeListSize])), -2)</code></li>
</ul></li>
<li>care with the brackets!</li>
<li>you might prefer to do simple rounding in the <strong>format visual</strong> area <br><img src="images/card_number_format.png" class="img-fluid" alt="Format visual">){height=“150px”}</li>
</ul>
</section>
<section id="filter" class="level2">
<h2 class="anchored" data-anchor-id="filter">Filter</h2>
<ul>
<li><code>FILTER()</code> is the last DAX function we’re going to look at</li>
<li>it lets us filter our data based on conditions</li>
<li>say we want to count how many big practices (more than 10000 patients) we have…</li>
<li><code>big_practices = countrows(filter(practices, practices[PracticeListSize] &gt; 10000))</code></li>
</ul>
</section>
<section id="filter-1" class="level2">
<h2 class="anchored" data-anchor-id="filter-1">Filter</h2>
<ul>
<li><code>big_practices = countrows(filter(practices, practices[PracticeListSize] &gt; 10000))</code></li>
<li>let’s read this from the inside-out</li>
<li><code>filter(practices, practices[PracticeListSize] &gt; 10000)</code> applies the filter function over the whole <strong>practices</strong> table</li>
<li>it finds all the rows where <strong>PracticeListSize</strong> is greater than (&gt;) 10000</li>
<li>those rows are then counted by <code>countrows()</code></li>
<li>finally, we save that number into our measure named <code>big_practices</code></li>
</ul>
</section>
<section id="filter-2" class="level2">
<h2 class="anchored" data-anchor-id="filter-2">Filter</h2>
<ul>
<li>that’ll be another ugly-but-functional measure</li>
<li>we’ll use an alternative way of beautifying this one, to avoid making the formula too complicated</li>
<li>measures can contain measures</li>
<li>instead of the <strong>table[column]</strong> format we’ve been using, we refer to measures by wrapping them in single square-brackets: <em>[measure]</em></li>
</ul>
</section>
<section id="filter-3" class="level2">
<h2 class="anchored" data-anchor-id="filter-3">Filter</h2>
<ul>
<li>let’s create this now</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled" title="Task">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>add a new measure to your measures table</li>
<li>use the formula <code>big_practices = countrows(filter(practices, practices[PracticeListSize] &gt; 10000))</code> to obtain the filtered count of big practices</li>
<li>create a second new measure</li>
<li><code>nice_big_practices = [big_practices] &amp; " practices with more than 10000 patients"</code></li>
<li>add <strong>nice_big_practices</strong> to a new card</li>
</ol>
</div>
</div>
</section>
<section id="beautifying-average_practice" class="level2">
<h2 class="anchored" data-anchor-id="beautifying-average_practice">Beautifying <strong>average_practice</strong></h2>
<div class="callout callout-style-default callout-tip callout-titled" title="Task">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Please make a new meaure named <strong>nice_average_practice</strong></li>
<li>Use concatenation to make the <strong>average_practice</strong> measure nicer to read</li>
<li>Update your average measure card in the report</li>
</ol>
</div>
</div>
</section>
<section id="more-interesting-filters" class="level2">
<h2 class="anchored" data-anchor-id="more-interesting-filters">More interesting filters</h2>
<ul>
<li><code>FILTER()</code> is one of the big building-blocks of Power BI</li>
<li>we can use it as a way of looking up matching data</li>
<li>for example, to find the <strong>name</strong> of the largest practice, we can:</li>
</ul>
<pre><code>largest_practice_name = CALCULATE (
    VALUES (practices[Practice Name]),
    FILTER (
      ALL(practices[PracticeListSize]), 
      practices[PracticeListSize] = MAX (practices[PracticeListSize]
            )
            )
)</code></pre>
<ul>
<li><code>FILTER()</code> finds the largest practice</li>
<li><code>VALUES()</code> returns the corresponding value from the <strong>Practice Name</strong> column</li>
<li><code>CALCULATE()</code> joins the <code>FILTER()</code> and <code>VALUES()</code> parts of the expression</li>
</ul>
</section>
<section id="dax-resources-beginners" class="level2">
<h2 class="anchored" data-anchor-id="dax-resources-beginners">DAX resources (beginners)</h2>
<ul>
<li>DAX sandbox - <a href="dax.do">dax.do</a></li>
<li>DAX introduction on the <a href="https://support.microsoft.com/en-us/office/quickstart-learn-dax-basics-in-30-minutes-51744643-c2a5-436a-bdf6-c895762bec1a">Microsoft site</a></li>
<li><a href="https://pragmaticworks.com/wp-content/uploads/2020/08/DAX-Cheat-Sheet.pdf">cheat sheet from Pragmatic Works</a> - good as an introduction</li>
<li><a href="https://data-flair.training/blogs/power-bi-dax-basics/">introduction to DAX from Data Flair</a> is particularly useful if you have a bit of prior experience</li>
<li><a href="https://medium.com/@saurabh.dasgupta1/dax-cheat-sheet-part-1-7e5dbc277e41">Saurabh dasgupta’s DAX cheat sheet</a></li>
</ul>
</section>
<section id="dax-resources-advanced" class="level2">
<h2 class="anchored" data-anchor-id="dax-resources-advanced">DAX resources (advanced)</h2>
<ul>
<li><a href="https://docs.microsoft.com/en-gb/dax/">DAX reference</a></li>
<li><a href="https://www.daxformatter.com/raw/">DAX formatting utility</a></li>
<li><a href="https://docs.microsoft.com/en-us/dax/best-practices/dax-variables">Helpful tutorial on DAX variables</a></li>
<li>Marco Russo and Alberto Ferrari’s book <em>The Definitive Guide to DAX: Business intelligence for Microsoft Power BI, SQL Server Analysis Services, and Excel</em> is the standard big reference book</li>
<li>I’ve also heard good things about <a href="https://daxstudio.org/">DAX Studio</a> as a helper for writing more complex DAX functions - broadly analogous to an <a href="https://en.wikipedia.org/wiki/Integrated_development_environment">IDE</a> for DAX</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/NES-DEW\.github\.io\/KIND-training\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>