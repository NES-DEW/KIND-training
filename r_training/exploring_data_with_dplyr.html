<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="dcterms.date" content="2025-05-19">
<title>Exploring data with dplyr â€“ KIND training pages</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-bc185b5c5bdbcb35c2eb49d8a876ef70.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-d68be38d83eca2bb035acf846ffba811.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-6afab9c3bf6556c536f2e34ed27c5dd0.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-d68be38d83eca2bb035acf846ffba811.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head>
<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">KIND training pages</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../excel_main.html"> 
<span class="menu-text">Excel</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../r_main.html"> 
<span class="menu-text">R</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../BI_main.html"> 
<span class="menu-text">Power Platform</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../tableau_main.html"> 
<span class="menu-text">Tableau</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../skills_main.html"> 
<span class="menu-text">Skills</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html"> 
<span class="menu-text">ðŸ“… Training schedule</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/NES-DEW/KIND-training">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/NES-DEW/KIND-training/issues">
            Report a Bug
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#session-outline" id="toc-session-outline" class="nav-link active" data-scroll-target="#session-outline">Session outline</a></li>
  <li><a href="#a-starting-point" id="toc-a-starting-point" class="nav-link" data-scroll-target="#a-starting-point">A starting-point</a></li>
  <li>
<a href="#investigating-data" id="toc-investigating-data" class="nav-link" data-scroll-target="#investigating-data">Investigating data</a>
  <ul class="collapse">
<li><a href="#slice" id="toc-slice" class="nav-link" data-scroll-target="#slice"><code>slice()</code></a></li>
  <li><a href="#glimpse" id="toc-glimpse" class="nav-link" data-scroll-target="#glimpse"><code>glimpse()</code></a></li>
  <li><a href="#rename-and-rename_with" id="toc-rename-and-rename_with" class="nav-link" data-scroll-target="#rename-and-rename_with"><code>rename()</code> (and <code>rename_with()</code>)</a></li>
  <li><a href="#relocate" id="toc-relocate" class="nav-link" data-scroll-target="#relocate"><code>relocate()</code></a></li>
  <li><a href="#case_when" id="toc-case_when" class="nav-link" data-scroll-target="#case_when"><code>case_when()</code></a></li>
  <li><a href="#case_match" id="toc-case_match" class="nav-link" data-scroll-target="#case_match"><code>case_match()</code></a></li>
  <li><a href="#consecutive_id" id="toc-consecutive_id" class="nav-link" data-scroll-target="#consecutive_id"><code>consecutive_id()</code></a></li>
  </ul>
</li>
  </ul></nav>
    <div class="quarto-margin-footer"><div class="margin-footer-item">
<p xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/">
<a property="dct:title" rel="cc:attributionURL" href="https://nes-dew.github.io/KIND-training">KIND learning network training materials</a> by <span property="cc:attributionName">KIND learning network</span> is licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-SA 4.0<img style="height:16px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" alt=""><img style="height:16px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" alt=""><img style="height:16px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1" alt=""></a>
</p>
</div></div></div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Exploring data with dplyr</h1>
  <div class="quarto-categories">
    <div class="quarto-category">R</div>
    <div class="quarto-category">intermediate</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 19, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header><div class="cell" data-layout-align="left">
<p>No feedback found for this session</p>
</div>
<section id="session-outline" class="level2"><h2 class="anchored" data-anchor-id="session-outline">Session outline</h2>
<p>This session is an ðŸŒ¶ðŸŒ¶ <strong>intermediate practical</strong> designed for those with some R experience. The aim of this session is to do three things with dplyr:</p>
<ul>
<li>build your fluency with basic dplyr functionality</li>
<li>show some of the similarities of approach across the package, again to help you master the syntax</li>
<li>learn some of the more advanced functions to harness the power available beneath the surface</li>
</ul>
<p>You might also like some of the other dplyr-themed practical sessions:</p>
<ul>
<li><a href="../r_training/dplyr_group_summarise.html">Summarising data with dplyr</a></li>
<li><a href="../r_training/dplyr_joins.html">Joining data with dplyr</a></li>
<li><a href="../r_training/tidyselect.html">Tidyselect</a></li>
</ul></section><section id="a-starting-point" class="level2"><h2 class="anchored" data-anchor-id="a-starting-point">A starting-point</h2>
<p>You should have at least some previous experience working with dplyr before starting this training. Specifically, you should be familiar with at least:</p>
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, to select columns from data</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, to select rows from data</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, to make new columns from existing columns</li>
</ul></section><section id="investigating-data" class="level2"><h2 class="anchored" data-anchor-id="investigating-data">Investigating data</h2>
<p>Dplyr is usually used as a toolkit for manipulating tidy data. This session concentrates on some lesser-used functions in the dplyr package that are especially useful earlier in the analysis lifecycle when exploring new data: <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code>, <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code>/<code><a href="https://dplyr.tidyverse.org/reference/case_match.html">case_match()</a></code>, and <code><a href="https://dplyr.tidyverse.org/reference/consecutive_id.html">consecutive_id()</a></code></p>
<p>Package loading as follows:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nhs-r-community/NHSRdatasets">NHSRdatasets</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="slice" class="level3"><h3 class="anchored" data-anchor-id="slice"><code>slice()</code></h3>
<p>Itâ€™s definitely worth pointing you towards the <a href="https://dplyr.tidyverse.org/reference/slice.html">slice() manual page</a> - itâ€™s clear and interesting.</p>
<p>At its simplest, <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> is an alternative to head:</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ae_attendances</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 Ã— 6
  period     org_code type  attendances breaches admissions
  &lt;date&gt;     &lt;fct&gt;    &lt;fct&gt;       &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
1 2017-03-01 RF4      1           21289     2879       5060
2 2017-03-01 RF4      2             813       22          0
3 2017-03-01 RF4      other        2850        6          0
4 2017-03-01 R1H      1           30210     5902       6943
5 2017-03-01 R1H      2             807       11          0
6 2017-03-01 R1H      other       11352      136          0</code></pre>
</div>
</div>
<p>The number supplied to <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> returns that row - so <code>slice(3)</code> shows the third row. You can also provide a sequence or vector of rows:</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ae_attendances</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 6
  period     org_code type  attendances breaches admissions
  &lt;date&gt;     &lt;fct&gt;    &lt;fct&gt;       &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
1 2017-03-01 RF4      1           21289     2879       5060
2 2017-03-01 RF4      2             813       22          0
3 2017-03-01 RF4      other        2850        6          0</code></pre>
</div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ae_attendances</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">5</span>,<span class="fl">918</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 6
  period     org_code type  attendances breaches admissions
  &lt;date&gt;     &lt;fct&gt;    &lt;fct&gt;       &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
1 2017-03-01 RF4      2             813       22          0
2 2017-03-01 R1H      2             807       11          0
3 2017-01-01 RQ6      other       10253        0          0</code></pre>
</div>
</div>
<p>More interestingly, you can <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>, then slice, to see the first row of each group. Here, the data is filtered, grouped by org_code, then we slice the top row of each group:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ae_attendances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">attendances</span> <span class="op">&gt;=</span> <span class="fl">22000</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">org_code</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 Ã— 6
# Groups:   org_code [4]
  period     org_code type  attendances breaches admissions
  &lt;date&gt;     &lt;fct&gt;    &lt;fct&gt;       &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
1 2017-10-01 R0A      1           22392     3628       6836
2 2017-03-01 R1H      1           30210     5902       6943
3 2019-03-01 RRK      1           32017    10670      10850
4 2017-03-01 RW6      1           22930     4997       5328</code></pre>
</div>
</div>
<p>(weâ€™ll explore <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> in the <a href="../r_training/dplyr_group_summarise.html">summarising data with dplyr</a> session, so donâ€™t worry if this is unfamiliar)</p>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_min()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max()</a></code> functions are also useful, giving you something like an integrated <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> for looking at slices of the data:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ae_attendances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"1"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="va">breaches</span>, n<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 6
  period     org_code type  attendances breaches admissions
  &lt;date&gt;     &lt;fct&gt;    &lt;fct&gt;       &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
1 2019-01-01 RRK      1           31935    12502      11493</code></pre>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># equivalent to</span></span>
<span><span class="va">ae_attendances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">breaches</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 6
  period     org_code type  attendances breaches admissions
  &lt;date&gt;     &lt;fct&gt;    &lt;fct&gt;       &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
1 2019-01-01 RRK      1           31935    12502      11493</code></pre>
</div>
</div>
<p>(note that you need to explicitly name the number of rows you want using <code>n=...</code>)</p>
<p><code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_min()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max()</a></code> are particularly useful for groups:</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ae_attendances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"1"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">org_code</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="va">breaches</span>, n<span class="op">=</span><span class="fl">1</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 140 Ã— 6
# Groups:   org_code [140]
   period     org_code type  attendances breaches admissions
   &lt;date&gt;     &lt;fct&gt;    &lt;fct&gt;       &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
 1 2019-01-01 R0A      1           21980     6206       6985
 2 2018-11-01 R1F      1            3810     1262        967
 3 2017-01-01 R1H      1           28420     7426       6435
 4 2017-01-01 R1K      1           11961     5897       4587
 5 2019-01-01 RA2      1            6242     1071       2513
 6 2017-01-01 RA3      1            4073     1471       1074
 7 2016-06-01 RA4      1            3992      454       1057
 8 2016-11-01 RA7      1            9625     2445       3064
 9 2019-01-01 RA9      1            6056     2053       2557
10 2019-03-01 RAE      1           10698     3438       2854
# â„¹ 130 more rows</code></pre>
</div>
</div>
<p><code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample()</a></code> gives a random sampling of the data.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ae_attendances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">6</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 Ã— 6
  period     org_code type  attendances breaches admissions
  &lt;date&gt;     &lt;fct&gt;    &lt;fct&gt;       &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
1 2016-04-01 RL4      1           10811     1613       2740
2 2016-11-01 RBT      1            4886      443       1772
3 2016-12-01 RBL      1            8142     1819       2588
4 2018-09-01 RWF      other        2346        1          0
5 2016-04-01 RC9      1            7983      128       2251
6 2017-11-01 Y02428   other        2549        0          0</code></pre>
</div>
</div>
<p>There are also <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_tail()</a></code> functions which work in the same way.</p>
<p>Final tip - slice with a negative index can be used as like <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> to remove the specified row(s):</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># returns the last 5 rows only</span></span>
<span><span class="va">ae_attendances</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="op">-</span><span class="fl">12760</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 6
  period     org_code type  attendances breaches admissions
  &lt;date&gt;     &lt;fct&gt;    &lt;fct&gt;       &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
1 2018-04-01 Y02584   other         471        0          0
2 2018-04-01 RA3      1            3825      476       1016
3 2018-04-01 AXG      other        2980       24          0
4 2018-04-01 NLX24    other        1538        0          0
5 2018-04-01 RA4      1            4388       82       1292</code></pre>
</div>
</div>
</section><section id="glimpse" class="level3"><h3 class="anchored" data-anchor-id="glimpse"><code>glimpse()</code></h3>
<p><code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code> is a data viewing function similar to <code><a href="https://rdrr.io/r/base/print.html">print()</a></code>, except it transposes the data so that each column is displayed as a row. This is particularly useful for wide data with many columns, especially when you are interested in checking the class (date, character, etc.) of your columns.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">synthetic_news_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,000
Columns: 12
$ male  &lt;int&gt; 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1â€¦
$ age   &lt;int&gt; 68, 94, 85, 44, 77, 58, 25, 69, 91, 70, 87, 93, 61, 75, 97, 80, â€¦
$ NEWS  &lt;int&gt; 3, 1, 0, 0, 1, 1, 4, 0, 1, 1, 7, 2, 5, 1, 1, 3, 1, 5, 0, 2, 1, 2â€¦
$ syst  &lt;int&gt; 150, 145, 169, 154, 122, 146, 65, 116, 162, 132, 110, 166, 123, â€¦
$ dias  &lt;int&gt; 98, 67, 69, 106, 67, 106, 42, 56, 72, 96, 85, 90, 78, 80, 72, 81â€¦
$ temp  &lt;dbl&gt; 36.8, 35.0, 36.2, 36.9, 36.4, 35.3, 35.6, 37.2, 35.5, 35.3, 37.0â€¦
$ pulse &lt;int&gt; 78, 62, 54, 80, 62, 73, 72, 90, 60, 67, 95, 87, 93, 65, 89, 145,â€¦
$ resp  &lt;int&gt; 26, 18, 18, 17, 20, 20, 12, 16, 16, 16, 24, 16, 26, 12, 16, 16, â€¦
$ sat   &lt;int&gt; 96, 96, 96, 96, 95, 98, 99, 97, 99, 97, 87, 95, 96, 96, 98, 99, â€¦
$ sup   &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0â€¦
$ alert &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0â€¦
$ died  &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0â€¦</code></pre>
</div>
</div>
<p>Note the useful dimension information in the first two lines, and the class information in angle brackets. Okay, so there are lots of similar ways of displaying the same information, but <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code> is nice and concise both to write and to read. Compare a couple of base r (or purrr) near-equivalents, which are especially messy when the data is quite wide:</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">synthetic_news_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html">map_df</a></span><span class="op">(</span><span class="va">class</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 12
  male    age     NEWS    syst   dias  temp  pulse resp  sat   sup   alert died 
  &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
1 integer integer integer integâ€¦ inteâ€¦ numeâ€¦ inteâ€¦ inteâ€¦ inteâ€¦ inteâ€¦ inteâ€¦ inteâ€¦</code></pre>
</div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># equivalent in base R</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">synthetic_news_data</span>, <span class="va">class</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$male
[1] "integer"

$age
[1] "integer"

$NEWS
[1] "integer"

$syst
[1] "integer"

$dias
[1] "integer"

$temp
[1] "numeric"

$pulse
[1] "integer"

$resp
[1] "integer"

$sat
[1] "integer"

$sup
[1] "integer"

$alert
[1] "integer"

$died
[1] "integer"</code></pre>
</div>
</div>
<p><code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code> plays nicely with the pipe, meaning that itâ€™s potentially useful while youâ€™re working on a complicated data transformation. If you have lots of stages piped together, you can insert <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code> in periodically to check that each stage of your transformation is working as expected:</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">synthetic_news_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">age</span> <span class="op">==</span> <span class="fl">71</span> <span class="op">&amp;</span> <span class="va">male</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pulse_pres <span class="op">=</span> <span class="va">syst</span><span class="op">-</span><span class="va">dias</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,000
Columns: 12
$ male  &lt;int&gt; 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1â€¦
$ age   &lt;int&gt; 68, 94, 85, 44, 77, 58, 25, 69, 91, 70, 87, 93, 61, 75, 97, 80, â€¦
$ NEWS  &lt;int&gt; 3, 1, 0, 0, 1, 1, 4, 0, 1, 1, 7, 2, 5, 1, 1, 3, 1, 5, 0, 2, 1, 2â€¦
$ syst  &lt;int&gt; 150, 145, 169, 154, 122, 146, 65, 116, 162, 132, 110, 166, 123, â€¦
$ dias  &lt;int&gt; 98, 67, 69, 106, 67, 106, 42, 56, 72, 96, 85, 90, 78, 80, 72, 81â€¦
$ temp  &lt;dbl&gt; 36.8, 35.0, 36.2, 36.9, 36.4, 35.3, 35.6, 37.2, 35.5, 35.3, 37.0â€¦
$ pulse &lt;int&gt; 78, 62, 54, 80, 62, 73, 72, 90, 60, 67, 95, 87, 93, 65, 89, 145,â€¦
$ resp  &lt;int&gt; 26, 18, 18, 17, 20, 20, 12, 16, 16, 16, 24, 16, 26, 12, 16, 16, â€¦
$ sat   &lt;int&gt; 96, 96, 96, 96, 95, 98, 99, 97, 99, 97, 87, 95, 96, 96, 98, 99, â€¦
$ sup   &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0â€¦
$ alert &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0â€¦
$ died  &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0â€¦
Rows: 11
Columns: 12
$ male  &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
$ age   &lt;int&gt; 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71
$ NEWS  &lt;int&gt; 1, 1, 2, 1, 2, 1, 1, 2, 1, 2, 3
$ syst  &lt;int&gt; 128, 128, 137, 128, 114, 106, 128, 114, 132, 137, 102
$ dias  &lt;int&gt; 67, 81, 61, 81, 62, 56, 82, 66, 96, 78, 51
$ temp  &lt;dbl&gt; 38.2, 37.9, 36.4, 36.2, 35.9, 36.2, 37.9, 38.2, 35.4, 37.0, 35.8
$ pulse &lt;int&gt; 99, 101, 102, 73, 87, 72, 110, 103, 67, 102, 54
$ resp  &lt;int&gt; 17, 18, 17, 18, 16, 15, 17, 14, 17, 19, 18
$ sat   &lt;int&gt; 98, 96, 95, 95, 95, 97, 97, 99, 99, 95, 100
$ sup   &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1
$ alert &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
$ died  &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
Rows: 11
Columns: 13
$ male       &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
$ age        &lt;int&gt; 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71
$ NEWS       &lt;int&gt; 1, 1, 2, 1, 2, 1, 1, 2, 1, 2, 3
$ syst       &lt;int&gt; 128, 128, 137, 128, 114, 106, 128, 114, 132, 137, 102
$ dias       &lt;int&gt; 67, 81, 61, 81, 62, 56, 82, 66, 96, 78, 51
$ temp       &lt;dbl&gt; 38.2, 37.9, 36.4, 36.2, 35.9, 36.2, 37.9, 38.2, 35.4, 37.0,â€¦
$ pulse      &lt;int&gt; 99, 101, 102, 73, 87, 72, 110, 103, 67, 102, 54
$ resp       &lt;int&gt; 17, 18, 17, 18, 16, 15, 17, 14, 17, 19, 18
$ sat        &lt;int&gt; 98, 96, 95, 95, 95, 97, 97, 99, 99, 95, 100
$ sup        &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1
$ alert      &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
$ died       &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
$ pulse_pres &lt;int&gt; 61, 47, 76, 47, 52, 50, 46, 48, 36, 59, 51</code></pre>
</div>
</div>
</section><section id="rename-and-rename_with" class="level3"><h3 class="anchored" data-anchor-id="rename-and-rename_with">
<code>rename()</code> (and <code>rename_with()</code>)</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> renames columns. Like <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, the general syntax for <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> is <em>new name</em> = <em>old name</em>.</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">LOS_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>age <span class="op">=</span> <span class="va">Age</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 300 Ã— 5
      ID Organisation   age   LOS Death
   &lt;int&gt; &lt;ord&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1     1 Trust1          55     2     0
 2     2 Trust2          27     1     0
 3     3 Trust3          93    12     0
 4     4 Trust4          45     3     1
 5     5 Trust5          70    11     0
 6     6 Trust6          60     7     0
 7     7 Trust7          25     4     0
 8     8 Trust8          48     4     0
 9     9 Trust9          51     7     1
10    10 Trust10         81     1     0
# â„¹ 290 more rows</code></pre>
</div>
</div>
<p>Thereâ€™s not much more to say about the basic <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> function beyond that. However, the scoped variants, <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/select_all.html">rename_all()</a></code> provide some useful additional tools. For example, we can use <code><a href="https://rdrr.io/r/base/chartr.html">tolower()</a></code> - which converts strings to all lower-case - to rename multiple columns at once:</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">LOS_model</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span><span class="va">tolower</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 300 Ã— 5
      id organisation   age   los death
   &lt;int&gt; &lt;ord&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1     1 Trust1          55     2     0
 2     2 Trust2          27     1     0
 3     3 Trust3          93    12     0
 4     4 Trust4          45     3     1
 5     5 Trust5          70    11     0
 6     6 Trust6          60     7     0
 7     7 Trust7          25     4     0
 8     8 Trust8          48     4     0
 9     9 Trust9          51     7     1
10    10 Trust10         81     1     0
# â„¹ 290 more rows</code></pre>
</div>
</div>
<p><code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> works well with <a href="../r_training/tidyselect.html">tidyselect operators</a> too, as we discuss in that session.</p>
</section><section id="relocate" class="level3"><h3 class="anchored" data-anchor-id="relocate"><code>relocate()</code></h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate()</a></code> re-arranges the order of columns:</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">LOS_model</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 300 Ã— 5
      ID Organisation   Age   LOS Death
   &lt;int&gt; &lt;ord&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1     1 Trust1          55     2     0
 2     2 Trust2          27     1     0
 3     3 Trust3          93    12     0
 4     4 Trust4          45     3     1
 5     5 Trust5          70    11     0
 6     6 Trust6          60     7     0
 7     7 Trust7          25     4     0
 8     8 Trust8          48     4     0
 9     9 Trust9          51     7     1
10    10 Trust10         81     1     0
# â„¹ 290 more rows</code></pre>
</div>
</div>
<p><code><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate()</a></code>â€™s default behaviour is to move specified columns to the far left:</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">LOS_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">LOS</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 300 Ã— 5
     LOS    ID Organisation   Age Death
   &lt;int&gt; &lt;int&gt; &lt;ord&gt;        &lt;int&gt; &lt;int&gt;
 1     2     1 Trust1          55     0
 2     1     2 Trust2          27     0
 3    12     3 Trust3          93     0
 4     3     4 Trust4          45     1
 5    11     5 Trust5          70     0
 6     7     6 Trust6          60     0
 7     4     7 Trust7          25     0
 8     4     8 Trust8          48     0
 9     7     9 Trust9          51     1
10     1    10 Trust10         81     0
# â„¹ 290 more rows</code></pre>
</div>
</div>
<p>You can specify <code>.before</code> and <code>.after</code> if you need finer control over where your column ends up:</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">LOS_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">LOS</span>, .after<span class="op">=</span><span class="va">Death</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 300 Ã— 5
      ID Organisation   Age Death   LOS
   &lt;int&gt; &lt;ord&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1     1 Trust1          55     0     2
 2     2 Trust2          27     0     1
 3     3 Trust3          93     0    12
 4     4 Trust4          45     1     3
 5     5 Trust5          70     0    11
 6     6 Trust6          60     0     7
 7     7 Trust7          25     0     4
 8     8 Trust8          48     0     4
 9     9 Trust9          51     1     7
10    10 Trust10         81     0     1
# â„¹ 290 more rows</code></pre>
</div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">LOS_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">Death</span>, .before<span class="op">=</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># little bit of tidyselect</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 300 Ã— 5
      ID Organisation   Age   LOS Death
   &lt;int&gt; &lt;ord&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1     1 Trust1          55     2     0
 2     2 Trust2          27     1     0
 3     3 Trust3          93    12     0
 4     4 Trust4          45     3     1
 5     5 Trust5          70    11     0
 6     6 Trust6          60     7     0
 7     7 Trust7          25     4     0
 8     8 Trust8          48     4     0
 9     9 Trust9          51     7     1
10    10 Trust10         81     1     0
# â„¹ 290 more rows</code></pre>
</div>
</div>
</section><section id="case_when" class="level3"><h3 class="anchored" data-anchor-id="case_when"><code>case_when()</code></h3>
<p>The ONS mortality data in NHSRdatasets has several categories</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ons_mortality</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">category_1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 Ã— 2
  category_1                                                                   n
  &lt;chr&gt;                                                                    &lt;int&gt;
1 All respiratory diseases (ICD-10 J00-J99) ICD-10                           536
2 Deaths where COVID-19 was mentioned on the death certificate (ICD-10 U0â€¦    14
3 Females                                                                   3927
4 Males                                                                     3927
5 Persons                                                                   3927
6 Region                                                                    5350
7 Total deaths                                                              1056
8 average of same week over 5 years                                           14
9 &lt;NA&gt;                                                                        52</code></pre>
</div>
</div>
<p>Winter (metrological winter, for clarity) runs from the start of December to the end of February. Can we class the total deaths into winter, and non-winter categories? In practice, Iâ€™d be tempted to use <code><a href="https://lubridate.tidyverse.org/reference/quarter.html">lubridate::quarter()</a></code> with an appropriate starting offset for this kind of work if possible, especially if I was grouping into regular groups. Winter/non-winter isnâ€™t regular though, so <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> is the better option. Here, weâ€™ll work in stages. First, as weâ€™ll need the months, weâ€™ll extract those using <code><a href="https://lubridate.tidyverse.org/reference/month.html">lubridate::month()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ons_mortality</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">category_1</span> <span class="op">==</span> <span class="st">"Total deaths"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>month <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,056 Ã— 6
   category_1   category_2 counts date       week_no month
   &lt;chr&gt;        &lt;chr&gt;       &lt;dbl&gt; &lt;date&gt;       &lt;int&gt; &lt;dbl&gt;
 1 Total deaths all ages    12968 2010-01-08       1     1
 2 Total deaths all ages    12541 2010-01-15       2     1
 3 Total deaths all ages    11762 2010-01-22       3     1
 4 Total deaths all ages    11056 2010-01-29       4     1
 5 Total deaths all ages    10524 2010-02-05       5     2
 6 Total deaths all ages    10117 2010-02-12       6     2
 7 Total deaths all ages    10102 2010-02-19       7     2
 8 Total deaths all ages    10295 2010-02-26       8     2
 9 Total deaths all ages     9981 2010-03-05       9     3
10 Total deaths all ages     9792 2010-03-12      10     3
# â„¹ 1,046 more rows</code></pre>
</div>
</div>
<p>Our definition of winter is any case where that month is 1, 2, or 12. So use <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> to catch Jan and Feb:</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ons_mortality</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">category_1</span> <span class="op">==</span> <span class="st">"Total deaths"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>month <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>thing <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">month</span> <span class="op">&lt;</span> <span class="fl">3</span> <span class="op">~</span> <span class="st">"Winter"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,056 Ã— 7
   category_1   category_2 counts date       week_no month thing 
   &lt;chr&gt;        &lt;chr&gt;       &lt;dbl&gt; &lt;date&gt;       &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; 
 1 Total deaths all ages    12968 2010-01-08       1     1 Winter
 2 Total deaths all ages    12541 2010-01-15       2     1 Winter
 3 Total deaths all ages    11762 2010-01-22       3     1 Winter
 4 Total deaths all ages    11056 2010-01-29       4     1 Winter
 5 Total deaths all ages    10524 2010-02-05       5     2 Winter
 6 Total deaths all ages    10117 2010-02-12       6     2 Winter
 7 Total deaths all ages    10102 2010-02-19       7     2 Winter
 8 Total deaths all ages    10295 2010-02-26       8     2 Winter
 9 Total deaths all ages     9981 2010-03-05       9     3 &lt;NA&gt;  
10 Total deaths all ages     9792 2010-03-12      10     3 &lt;NA&gt;  
# â„¹ 1,046 more rows</code></pre>
</div>
</div>
<p>and then add an extra case to deal with December:</p>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ons_mortality</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">category_1</span> <span class="op">==</span> <span class="st">"Total deaths"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>month <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>season <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">month</span> <span class="op">&lt;</span> <span class="fl">3</span> <span class="op">~</span> <span class="st">"Winter"</span>,</span>
<span>                           <span class="va">month</span> <span class="op">==</span> <span class="fl">12</span> <span class="op">~</span> <span class="st">"Winter"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,056 Ã— 7
   category_1   category_2 counts date       week_no month season
   &lt;chr&gt;        &lt;chr&gt;       &lt;dbl&gt; &lt;date&gt;       &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; 
 1 Total deaths all ages    12968 2010-01-08       1     1 Winter
 2 Total deaths all ages    12541 2010-01-15       2     1 Winter
 3 Total deaths all ages    11762 2010-01-22       3     1 Winter
 4 Total deaths all ages    11056 2010-01-29       4     1 Winter
 5 Total deaths all ages    10524 2010-02-05       5     2 Winter
 6 Total deaths all ages    10117 2010-02-12       6     2 Winter
 7 Total deaths all ages    10102 2010-02-19       7     2 Winter
 8 Total deaths all ages    10295 2010-02-26       8     2 Winter
 9 Total deaths all ages     9981 2010-03-05       9     3 &lt;NA&gt;  
10 Total deaths all ages     9792 2010-03-12      10     3 &lt;NA&gt;  
# â„¹ 1,046 more rows</code></pre>
</div>
</div>
<p>And finally a default to catch all the non-Winter values:</p>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">seasonal_ons_mortality</span> <span class="op">&lt;-</span> <span class="va">ons_mortality</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">category_1</span> <span class="op">==</span> <span class="st">"Total deaths"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>month <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>season <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">month</span> <span class="op">&lt;</span> <span class="fl">3</span> <span class="op">~</span> <span class="st">"Winter"</span>,</span>
<span>                           <span class="va">month</span> <span class="op">==</span> <span class="fl">12</span> <span class="op">~</span> <span class="st">"Winter"</span>,</span>
<span>                           <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"Not winter"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">seasonal_ons_mortality</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,056 Ã— 7
   category_1   category_2 counts date       week_no month season    
   &lt;chr&gt;        &lt;chr&gt;       &lt;dbl&gt; &lt;date&gt;       &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;     
 1 Total deaths all ages    12968 2010-01-08       1     1 Winter    
 2 Total deaths all ages    12541 2010-01-15       2     1 Winter    
 3 Total deaths all ages    11762 2010-01-22       3     1 Winter    
 4 Total deaths all ages    11056 2010-01-29       4     1 Winter    
 5 Total deaths all ages    10524 2010-02-05       5     2 Winter    
 6 Total deaths all ages    10117 2010-02-12       6     2 Winter    
 7 Total deaths all ages    10102 2010-02-19       7     2 Winter    
 8 Total deaths all ages    10295 2010-02-26       8     2 Winter    
 9 Total deaths all ages     9981 2010-03-05       9     3 Not winter
10 Total deaths all ages     9792 2010-03-12      10     3 Not winter
# â„¹ 1,046 more rows</code></pre>
</div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">seasonal_ons_mortality</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">season</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 2
  season         n
  &lt;chr&gt;      &lt;int&gt;
1 Not winter   793
2 Winter       263</code></pre>
</div>
</div>
</section><section id="case_match" class="level3"><h3 class="anchored" data-anchor-id="case_match"><code>case_match()</code></h3>
<p>Rather than a logical test, <code><a href="https://dplyr.tidyverse.org/reference/case_match.html">case_match()</a></code> matches against values rather than performing a logical test. This is excellent for the winter classification example:</p>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ons_mortality</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">category_1</span> <span class="op">==</span> <span class="st">"Total deaths"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>month <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>season <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html">case_match</a></span><span class="op">(</span><span class="va">month</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">12</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Winter"</span>,</span>
<span>                             .default <span class="op">=</span> <span class="st">"Not winter"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,056 Ã— 7
   category_1   category_2 counts date       week_no month season    
   &lt;chr&gt;        &lt;chr&gt;       &lt;dbl&gt; &lt;date&gt;       &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;     
 1 Total deaths all ages    12968 2010-01-08       1     1 Winter    
 2 Total deaths all ages    12541 2010-01-15       2     1 Winter    
 3 Total deaths all ages    11762 2010-01-22       3     1 Winter    
 4 Total deaths all ages    11056 2010-01-29       4     1 Winter    
 5 Total deaths all ages    10524 2010-02-05       5     2 Winter    
 6 Total deaths all ages    10117 2010-02-12       6     2 Winter    
 7 Total deaths all ages    10102 2010-02-19       7     2 Winter    
 8 Total deaths all ages    10295 2010-02-26       8     2 Winter    
 9 Total deaths all ages     9981 2010-03-05       9     3 Not winter
10 Total deaths all ages     9792 2010-03-12      10     3 Not winter
# â„¹ 1,046 more rows</code></pre>
</div>
</div>
</section><section id="consecutive_id" class="level3"><h3 class="anchored" data-anchor-id="consecutive_id"><code>consecutive_id()</code></h3>
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/consecutive_id.html">consecutive_id</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># puts groups together by changes. This would have been very useful for my transcripts</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 1 2 3 3 4 4</code></pre>
</div>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">repeats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>speaker <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"steve"</span>, <span class="st">"steve"</span>, <span class="st">"emma"</span>, <span class="st">"steve"</span>, <span class="st">"emma"</span>, <span class="st">"emma"</span><span class="op">)</span>,</span>
<span>       comment <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span> <span class="co"># repeated data</span></span>
<span></span>
<span><span class="va">repeats</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/consecutive_id.html">consecutive_id</a></span><span class="op">(</span><span class="va">speaker</span><span class="op">)</span><span class="op">)</span> <span class="co"># add a group that increments with each change of speaker</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 Ã— 3
  speaker comment group
  &lt;chr&gt;   &lt;chr&gt;   &lt;int&gt;
1 steve   a           1
2 steve   b           1
3 emma    c           2
4 steve   d           3
5 emma    e           4
6 emma    f           4</code></pre>
</div>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">repeats</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/consecutive_id.html">consecutive_id</a></span><span class="op">(</span><span class="va">speaker</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>comment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">comment</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 Ã— 3
# Groups:   group [4]
  speaker comment group
  &lt;chr&gt;   &lt;chr&gt;   &lt;int&gt;
1 steve   a b         1
2 emma    c           2
3 steve   d           3
4 emma    e f         4</code></pre>
</div>
</div>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/NES-DEW\.github\.io\/KIND-training\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->



</body></html>